# =============================================================================
# MNIST 验证实验配置
# MNIST Verification Experiment Configuration
# =============================================================================
# 用于使用 MNIST 数据集验证物理驱动盲去卷积管道

physics:
  n_modes: 15                    # Zernike 模式数量
  pupil_size: 64                 # 光瞳计算网格大小
  kernel_size: 33                # PSF 卷积核大小
  oversample_factor: 2           # FFT 过采样因子
  ref_wavelength: 550.0e-9       # 参考波长 (绿光)
  wavelengths:                   # RGB 波长列表
    - 620.0e-9                   # 红光
    - 550.0e-9                   # 绿光
    - 450.0e-9                   # 蓝光

ola:
  patch_size: 128                # 补丁大小 (256 可被 128 整除)
  stride: 64                     # 补丁步长 (50% 重叠)
  pad_to_power_2: true           # FFT 填充到 2 的幂
  use_newbp: true                # 启用 NewBP 算法

aberration_net:
  n_coeffs: 15                   # 输出 Zernike 系数数量
  a_max: 2.0                     # 系数约束范围
  type: "polynomial"             # 使用多项式像差网络
  polynomial:
    degree: 3                    # 3阶多项式 (GT 像差使用)
  mlp:
    hidden_dim: 64
    use_fourier: true
    fourier_scale: 5
    a_max_mlp: 3.0

restoration_net:
  n_channels: 3                  # 输入通道数 (RGB)
  n_classes: 3                   # 输出通道数 (RGB)
  base_filters: 32               # 基础滤波器数量 (轻量级调试)
  bilinear: true                 # 使用双线性插值上采样
  use_coords: true               # 启用坐标注入

training:
  optimizer:
    type: "adamw"
    lr_restoration: 1.0e-4       # 复原网络学习率
    lr_optics: 1.0e-5            # 像差网络学习率
    weight_decay: 0.01
  loss:
    lambda_sup: 0.0              # 自监督模式，无监督损失
    lambda_coeff: 0.01           # 系数正则化
    lambda_smooth: 0.01          # 空间平滑性正则化
  gradient_clip:
    restoration: 5.0
    optics: 1.0
  smoothness_grid_size: 16

data:
  batch_size: 4                  # 小批次调试
  image_height: 256              # 图像高度 (MNIST 拼贴后)
  image_width: 256               # 图像宽度 (MNIST 拼贴后)
  num_workers: 0                 # 单线程调试

experiment:
  name: "debug_mnist_mosaic"     # 实验名称
  seed: 42                       # 随机种子
  device: "cuda"                 # 计算设备
  epochs: 50                      # 训练轮数 (快速验证)
  save_interval: 1               # 每轮保存
  log_interval: 1                # 每轮日志
  output_dir: "results/mnist_debug"  # 输出目录
